{% extends '::base.html.twig' %}
{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript" src="{{ asset('commons/js/jquery.dataTables.js') }}"></script>
    <script type="text/javascript" src="{{ asset('commons/js/jquery.dataTables.ZeroClipboard.js') }}"></script>
    <script type="text/javascript" src="{{ asset('commons/js/jquery.dataTables.TableTools.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('commons/js/dt_settings.js') }}"></script>
    <script type="text/javascript" src="{{ asset('commons/js/jquery-ui.js') }}"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $('.records_list').dataTable({
                "sDom": "<'row'<'span6'TRl><'span6'f>r>t<'row'<'span6'i><'span6'p>>",
                "oTableTools": {
                    "aButtons": [
                        {"sExtends": "copy", "mColumns": "visible"},
                        {"sExtends": "xls", "mColumns": "visible"},
                        {"sExtends": "pdf", "mColumns": "visible"}
                    ],
                    "sSwfPath": "{{ asset('commons/swf/copy_cvs_xls_pdf.swf') }}"
                },
                "sPdfOrientation": "landscape",
                "sPaginationType": "bootstrap",
                "oLanguage": {
                    "sLengthMenu": "_MENU_ records per page"
                },
                "aLengthMenu": [
                    [10, 25, 50, 100, 200, -1],
                    [10, 25, 50, 100, 200, "All"]
                ]
            });
        });

        $(function () {
            $("#accordion").accordion();

            {% for validation in getValidations %}
            {#var fieldUrl = "{{ path('one_validation_result', { 'id': validation.id,'forms': forms, 'withLowerLevel': withLowerLevel,"organisationunitid":organisationunitid } ) }}";#}
            var fieldUrl = "{{ path('one_validation_result', { 'id': validation.id } ) }}";
            var forms = '{{ forms }}';
            var orgunit = '{{ organisationunitid.id }}'
            var withLower = '{{ withLowerLevel }}'
            var getFields = $.getJSON( fieldUrl,{"forms":forms,'orgunit':orgunit,'withLower':withLower }, function( jsonFields ) {
                var html = "<table id='table{{ validation.id }}' class='table table-bordered'>"
                html += "<thead>";
                html += "<tr>";
                html += "<th>Name</th>";
                html += "<th>Facility</th>";
                html += "<th>Dob</th>";
                html += "<th>Appointment</th>";
                html += "<th>Last Promo</th>";
                html += "</tr>";
                html += "</thead><tbody>";
                $.each( jsonFields, function( fieldKey, jsonField ) {
                    html += "<tr>";
                    html += "<td>"+jsonField.firstname+" "+  jsonField.middlename +" "+  jsonField.surname+" </td>";
                    html += "<td>"+jsonField.level5_facility+"</td>";
                    html += "<td>"+jsonField.dob+"</td>";
                    html += "<td>"+jsonField.first_appointment+"</td>";
                    html += "<td>"+jsonField.last_promo+"</td>";
                    html += "</tr>";
                });
                        html +="</tbody></table>";
                $("#collapse{{ validation.id }} .accordion-inner").html(html);
                $("#table{{ validation.id }}").dataTable( {
                    "sDom": "<'row'<'span6'TRl><'span6'f>r>t<'row'<'span6'i><'span6'p>>",
                    "oTableTools": {
                        "aButtons": [
                            {"sExtends":"copy","mColumns":"visible"},
                            {"sExtends":"xls","mColumns":"visible"},
                            {"sExtends":"pdf","mColumns":"visible"}
                        ],
                        "sSwfPath": "{{ asset('commons/swf/copy_cvs_xls_pdf.swf') }}"
                    },
                    "sPdfOrientation": "landscape",
                    "sPaginationType": "bootstrap",
                    "oLanguage": {
                        "sLengthMenu": "_MENU_ records per page"
                    },
                    "aLengthMenu": [[10, 25, 50,100,200, -1], [10, 25, 50,100,200, "All"]]
                });
            });
            {% endfor %}

        });
    </script>
{% endblock javascripts %}
{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('commons/css/dt_bootstrap.css') }}"/>
    <link rel="stylesheet" href="{{ asset('bundles/hrisrecords/css/jquery-ui.css') }}"/>
    <link rel="stylesheet" href="{{ asset('bundles/hrisrecords/css/style.css') }}"/>
    <link rel="stylesheet" href="{{ asset('bundles/hrisrecords/css/demo_page.css') }}"/>
{% endblock stylesheets %}

{% block right_content -%}
    <div class="container">
        <h1>
            <small>{{ title }}</small>
        </h1>

        <div class="accordion" id="accordion2">
            {% for validation in getValidations %}
            <div class="accordion-group">
                <div class="accordion-heading">
                    <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapse{{ validation.id }}">
                        {{ validation.description }}
                    </a>
                </div>
                <div id="collapse{{ validation.id }}" class="accordion-body collapse">
                    <div class="accordion-inner">
                        <div class="progress progress-striped active">
                            <div class="bar" style="width: 60%;"></div>
                        </div>
                        fetching data...
                    </div>
                </div>
            </div>
            {% endfor %}

        </div>

    </div>
{% endblock %}

